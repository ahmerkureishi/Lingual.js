/* Lingual.js v1.5.0
 * The MIT License (MIT)
 * Copyright (c) 2014 Maker Studios */
(function(a,b,c,d){"use strict";var e="Lingual",f="undefined"!=typeof module&&module.exports,g=g||function(g,h,i){var j,k,l,m,n=this;n.defaults={lang:"",fallbackLang:"en",pathDelimiter:".",selectorKey:"translate",cache:!1,fixFloats:!0,variants:!1,allowFallbackTranslations:!0,debug:!0},j={initialized:!1,localeStrings:{}},k={log:function(a){n.defaults.debug&&console.log(a)},client:function(a){return d&&b?a.call():void 0},cache:{supported:function(){return"localStorage"in a},get:function(b){return JSON.parse(a.localStorage.getItem(b))},set:function(b,c){return a.localStorage.setItem(b,JSON.stringify(c))}},parsePath:function(a,b){if(!b)return!1;var c,d=b.split(n.defaults.pathDelimiter);for(c=0;c<d.length;c++){var e=d[c];if("undefined"==typeof a[e])return!1;a=a[e]}return a},initLang:function(a){k.setLang(a||n.defaults.lang)},detectLang:function(){var a=n.defaults.variants?c.language:c.language.split("-")[0];return n.defaults.lang||j.html.attr("lang")||a||"en"},setLang:function(a){k.client(function(){j.html.attr("lang",a)}),n.defaults.lang=a},setLocales:function(a){j.localeStrings=a},getLocales:function(){return j.localeStrings},loader:{routine:function(a,b){if("string"==typeof a)k.loader.fetch(a,function(a){b(a)});else if(d.isArray(a)){var c=a.length,e=0,f={};d(a).each(function(){k.loader.fetch(this,function(a){f=d.extend(!0,f,a),e++,e==c&&b(f)})})}},fetch:function(a,b){if(n.defaults.cache&&k.cache.supported()){var c=k.cache.get(a);if(c)return b(c)}return d.getJSON(a,function(c){n.defaults.cache&&k.cache.supported()&&k.cache.set(a,c),b(c)})}},injectVars:function(a,b){b=b||{};var c;for(c in b)b.hasOwnProperty(c)&&(a=a.replace(":"+c,b[c]));return a}},l={translate:function(a){var c=n.defaults.selectorKey,f="data-"+c,g=d("["+f+"]",a),h=!1;if(n.defaults.fixFloats){var i=e+"-hide";d("head").append('<style type="text/css">.'+i+"{display: none !important}</style>")}j.reset&&(j.reset=!1,h=""),g.each(function(){var a=d(this),b=a.attr(f);if(b){var c=b.split(":"),e=c.length>1?c[0]:!1,g=e?c[1]:c[0];if(!g||e==f)return;g=g.trim();var l=h!==!1?h:k.parsePath(j.localeStrings[n.defaults.lang],g);if(l===!1&&h===!1&&n.defaults.allowFallbackTranslations&&n.defaults.fallbackLang in j.localeStrings){var m=k.parsePath(j.localeStrings[n.defaults.fallbackLang],g);m&&(k.log("Fallback translation for "+g+" exists"),l=m)}if(l!==!1){var o=a.attr("data-vars");if(o)try{o=JSON.parse(o),l=k.injectVars(l,o)}catch(p){n.defaults.debug&&k.log("Invalid JSON: "+o)}e===!1||"html"==e?a.html(l):"text"==e?a.text(l):a.attr(e,l),n.defaults.fixFloats&&(a.addClass(i),setTimeout(function(){a.removeClass(i)},0))}else k.log("Could not find translation for "+g)}}),(a||d(b)).trigger("translated")}},m={client:function(a,b){n.defaults=d.extend(n.defaults,b),j.html=d("html"),k.initLang(k.detectLang()),k.loader.routine(a,function(a){m.finish(a)})},server:function(a,b){var c=require("node.extend");n.defaults=c(n.defaults,b),k.initLang(),m.finish(a)},finish:function(a){if(!a[n.defaults.lang])if(k.log('Locales "'+n.defaults.lang+'" do not exist'),a[n.defaults.fallbackLang]&&n.defaults.fallbackLang!==n.defaults.lang)k.log('Falling back to "'+n.defaults.fallbackLang+'"'),k.setLang(n.defaults.fallbackLang);else if(Object.keys&&Object.keys(a).length){var b=Object.keys(a)[0];k.log('Locales "'+n.defaults.fallbackLang+'" do not exist, falling back to "'+b+'"'),k.setLang(b)}else k.log("Invalid Locale File");k.setLocales(a),k.client(function(){l.translate()}),j.initialized=!0,j.finish=(new Date).getTime(),"function"==typeof i&&i.call(n)}},n.locale=function(a){return"undefined"==typeof a?n.defaults.lang:void("undefined"!=typeof j.localeStrings[a]&&(n.defaults.lang=a))},n.addLocales=function(a){k.loader.routine(a,function(a){k.setLocales(d.extend(!0,k.getLocales(),a)),n.translate()})},n.data=function(){return k.getLocales()},n.reset=function(){j.reset=!0,k.setLang(k.detectLang()),n.translate()},n.translate=function(a){k.client(function(){l.translate(a)})},n.gettext=function(a,b){return j.initialized?k.injectVars(k.parsePath(j.localeStrings[n.defaults.lang],a),b):void 0},j.start=(new Date).getTime(),f?m.server(g,h):m.client(g,h)};f?module.exports=g:this[e]=g}).apply(this,"undefined"!=typeof document?[window,document,navigator,jQuery]:[]);