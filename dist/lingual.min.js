/* Lingual.js v1.3.8
 * The MIT License (MIT)
 * Copyright (c) 2014 Maker Studios */
(function(a,b,c,d){"use strict";var e="Lingual",f="undefined"!=typeof module&&module.exports,g=g||function(g,h){var i,j,k,l,m=this;m.defaults={lang:"",fallbackLang:"en",pathDelimiter:".",selectorKey:"translate",cache:!1,fixFloats:!0,variants:!1,debug:!0},i={localeStrings:{}},j={log:function(a){m.defaults.debug&&console.log(a)},client:function(a){return d&&b?a.call():void 0},cache:{supported:function(){return"localStorage"in a},get:function(b){return JSON.parse(a.localStorage.getItem(b))},set:function(b,c){return a.localStorage.setItem(b,JSON.stringify(c))}},parsePath:function(a,b){if(!b)return!1;var c,d=b.split(m.defaults.pathDelimiter);for(c=0;c<d.length;c++){var e=d[c];if("undefined"==typeof a[e])return!1;a=a[e]}return a},initLanguage:function(a){j.setLang(a||m.defaults.lang)},setLang:function(a){j.client(function(){i.html.attr("lang",a)}),m.defaults.lang=a},setLocales:function(a){i.localeStrings=a},injectVars:function(a,b){b=b||{};var c;for(c in b)b.hasOwnProperty(c)&&(a=a.replace(":"+c,b[c]));return a}},k={translate:function(a){var c=m.defaults.selectorKey,f="data-"+c,g=d("["+f+"]",a);if(m.defaults.fixFloats){var h=e+"-hide";d("head").append('<style type="text/css">.'+h+"{display: none !important}</style>")}g.each(function(){var a=d(this),b=a.attr(f);if(b){var c=b.split(":"),e=c.length>1?c[0]:!1,g=e?c[1]:c[0];if(!g||e==f)return;g=g.trim();var k=j.parsePath(i.localeStrings[m.defaults.lang],g);if(k){var l=a.attr("data-vars");if(l)try{l=JSON.parse(l),k=j.injectVars(k,l)}catch(n){m.defaults.debug&&j.log("Invalid JSON: "+l)}e===!1||"html"==e?a.html(k):"text"==e?a.text(k):a.attr(e,k),m.defaults.fixFloats&&(a.addClass(h),setTimeout(function(){a.removeClass(h)},0))}else j.log("Could not find translation for "+g)}}),(a||d(b)).trigger("translated")}},l={client:function(a,b){m.defaults=d.extend(m.defaults,b),i.html=d("html");var e=m.defaults.variants?c.language:c.language.split("-")[0];if(j.initLanguage(m.defaults.lang||i.html.attr("lang")||e||"en"),"string"==typeof a){if(m.defaults.cache&&j.cache.supported()){var f=j.cache.get(localeLocation);if(f)return l.finish(f)}return void d.getJSON(a,function(a){m.defaults.cache&&j.cache.supported()&&j.cache.set(localeLocation,a),l.finish(a)})}l.finish(a)},server:function(a,b){var c=require("node.extend");m.defaults=c(m.defaults,b),j.initLanguage(),l.finish(a)},finish:function(a){a[m.defaults.lang]||(j.log('Locales "'+m.defaults.lang+'" do not exist, falling back to "'+m.defaults.fallbackLang+'"'),j.setLang(m.defaults.fallbackLang)),j.setLocales(a),j.client(function(){k.translate()}),i.finish=(new Date).getTime()}},m.locale=function(a){return"undefined"==typeof a?m.defaults.lang:void("undefined"!=typeof i.localeStrings[a]&&(m.defaults.lang=a))},m.translate=function(a){j.client(function(){k.translate(a)})},m.gettext=function(a,b){return j.injectVars(j.parsePath(i.localeStrings[m.defaults.lang],a),b)},i.start=(new Date).getTime(),f?l.server(g,h):l.client(g,h)};f?module.exports=g:this[e]=g}).apply(this,"undefined"!=typeof document?[window,document,navigator,jQuery]:[]);