/* Lingual.js v1.3.1
 * The MIT License (MIT)
 * Copyright (c) 2014 Maker Studios */
(function(a,b,c,d){"use strict";var e="Lingual",f="undefined"!=typeof module&&module.exports,g=g||function(e,g){var h,i,j,k,l=this;l.defaults={lang:"",pathDelimiter:".",selectorKey:"translate",cache:!0,fixFloats:!0,variants:!1,debug:!0},h={localeStrings:{}},i={log:function(a){l.defaults.debug&&console.log(a)},client:function(a){return d&&b?a.call():void 0},cache:{supported:function(){return"localStorage"in a},get:function(b){return JSON.parse(a.localStorage.getItem(b))},set:function(b,c){return a.localStorage.setItem(b,JSON.stringify(c))}},parsePath:function(a,b){if(!b)return!1;var c,d=b.split(l.defaults.pathDelimiter);for(c=0;c<d.length;c++){var e=d[c];if("undefined"==typeof a[e])return!1;a=a[e]}return a},initLanguage:function(a){i.setLang(a||l.defaults.lang)},setLang:function(a){i.client(function(){h.html.attr("lang",a)}),l.defaults.lang=a},setLocales:function(a){h.localeStrings=a},injectVars:function(a,b){b=b||{};var c;for(c in b)b.hasOwnProperty(c)&&(a=a.replace(":"+c,b[c]));return a}},j={translate:function(a){var c=l.defaults.selectorKey,e="data-"+c,f=d("["+e+"]",a);f.each(function(){var a=d(this),b=a.attr(e);if(b){var c=b.split(":"),f=c.length>1?c[0]:!1,g=f?c[1]:c[0];if(!g||f==e)return;g=g.trim();var j=i.parsePath(h.localeStrings[l.defaults.lang],g);if(j){var k=a.attr("data-vars");if(k)try{k=JSON.parse(k),j=i.injectVars(j,k)}catch(m){l.defaults.debug&&i.log("Invalid JSON: "+k)}f===!1||"html"==f?a.html(j):"text"==f?a.text(j):a.attr(f,j),l.defaults.fixFloats&&(a.css("display","none"),setTimeout(function(){a.css("display","")},0))}else i.log("Could not find translation for "+g)}}),(a||d(b)).trigger("translated")}},k={client:function(a,b){l.defaults=d.extend(l.defaults,b),h.html=d("html");var e=l.defaults.variants?c.language:c.language.split("-")[0];if(i.initLanguage(l.defaults.lang||h.html.attr("lang")||e||"en"),"string"==typeof a){var f=a.replace("%LANG%",l.defaults.lang);if(l.defaults.cache&&i.cache.supported()){var g=i.cache.get(f);if(g)return k.finish(g)}return void d.getJSON(f,function(a){l.defaults.cache&&i.cache.supported()&&i.cache.set(f,a),k.finish(a)})}k.finish(a)},server:function(a,b){var c=require("node.extend");l.defaults=c(l.defaults,b),i.initLanguage(),k.finish(a)},finish:function(a){if("undefined"==typeof a[l.defaults.lang]){var b={};b[l.defaults.lang]=a,a=b}i.setLocales(a),i.client(function(){j.translate()}),h.finish=(new Date).getTime()}},l.locale=function(a){return"undefined"==typeof a?l.defaults.lang:void("undefined"!=typeof h.localeStrings[a]&&(l.defaults.lang=a))},l.translate=function(a){i.client(function(){j.translate(a)})},l.gettext=function(a,b){return i.injectVars(i.parsePath(h.localeStrings[l.defaults.lang],a),b)},h.start=(new Date).getTime(),f?k.server(e,g):k.client(e,g)};f?module.exports=g:this[e]=g}).apply(this,"undefined"!=typeof document?[window,document,navigator,jQuery]:[]);