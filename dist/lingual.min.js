/* Lingual.js v1.9.0
 * The MIT License (MIT)
 * Copyright (c) 2014 Maker Studios */
(function(a,b,c,d){"use strict";var e="Lingual",f="undefined"!=typeof module&&module.exports,g=g||function(h,i,j){var k,l,m,n,o=this;o.defaults={lang:"",fallbackLang:"en",pathDelimiter:".",selectorKey:"translate",cache:!1,fixFloats:!0,variants:!1,allowFallbackTranslations:!0,debug:!1,autoTranslate:!0},k={initialized:!1,localeStrings:{}},l={log:function(a){o.defaults.debug&&console.log(a)},client:function(a){return d&&b?a.call():void 0},cache:{supported:function(){return"localStorage"in a},get:function(b){return JSON.parse(a.localStorage.getItem(b))},set:function(b,c){return a.localStorage.setItem(b,JSON.stringify(c))}},parsePath:function(a,b){if(b){var c,d=b.split(o.defaults.pathDelimiter);for(c=0;c<d.length;c++){var e=d[c];if("undefined"==typeof a[e])return;a=a[e]}return a}},initLang:function(a){l.setLang(a||o.defaults.lang)},detectLang:function(){!c.language&&c.browserLanguage&&(c.language=c.browserLanguage);var a=o.defaults.variants?c.language:c.language.split("-")[0];return o.defaults.lang||k.html.attr("lang")||a||"en"},setLang:function(a){l.client(function(){k.html.attr("lang",a)}),o.defaults.lang=a},updateLocales:function(a){k.localeStrings=d.extend(!0,k.localeStrings,a)},getLocales:function(){return k.localeStrings},loader:{routine:function(a,b){if("string"==typeof a)l.loader.fetch(a,function(a){b(a)});else if(d.isArray(a)){var c=a.length,e=0,f={};d(a).each(function(){l.loader.fetch(this,function(a){f=d.extend(!0,f,a),e++,e==c&&b(f)})})}},fetch:function(a,b){if(o.defaults.cache&&l.cache.supported()){var c=l.cache.get(a);if(c)return b(c)}return d.getJSON(a,function(c){o.defaults.cache&&l.cache.supported()&&l.cache.set(a,c),b(c)})}},translate:{inject:function(a,b){if(a){b=b||{};var c;for(c in b)b.hasOwnProperty(c)&&(a=a.replace(":"+c,b[c]));return a}},fetch:function(a,b){b="undefined"==typeof b?!1:b;var c=b!==!1?b:l.parsePath(k.localeStrings[o.defaults.lang],a);if(void 0===c&&b===!1&&o.defaults.allowFallbackTranslations){if(!(o.defaults.fallbackLang in k.localeStrings))return c;var d=l.parsePath(k.localeStrings[o.defaults.fallbackLang],a);d&&(l.log("Fallback translation for "+a+" exists"),c=d)}return c}}},m={translate:function(a){var c=o.defaults.selectorKey,f="data-"+c,g=d("["+f+"]",a),h=!1,i=e+"-hide";o.defaults.fixFloats&&(0===d("#"+e+"-styles").length&&d("head").append('<style type="text/css" id="'+e+'-styles">.'+i+" ["+f+"]{display: none !important}</style>"),i&&d("body").addClass(i)),k.reset&&(k.reset=!1,h=""),g.each(function(){var a=d(this),b=a.attr(f);if(b){var c=b.split(":"),e=c.length>1?c[0]:!1,g=e?c[1]:c[0];if(!g||e==f)return;g=g.trim();var i=l.translate.fetch(g,h);if(void 0!==i){var j=a.attr("data-vars");if(j)try{j=JSON.parse(j),i=l.translate.inject(i,j)}catch(k){o.defaults.debug&&l.log("Invalid JSON: "+j)}e===!1||"html"==e?a.html(i):"text"==e?a.text(i):a.attr(e,i)}else l.log("Could not find translation for "+g)}}),o.defaults.fixFloats&&i&&setTimeout(function(){d("body").removeClass(i)},50),(a||d(b)).trigger("translated")}},n={client:function(a,b){g.globals&&(o.defaults=d.extend(o.defaults,g.globals)),o.defaults=d.extend(o.defaults,b),k.html=d("html"),l.initLang(l.detectLang()),l.loader.routine(a,function(a){n.finish(a)})},server:function(a,b){var c=require("node.extend");o.defaults=c(o.defaults,b),l.initLang(),n.finish(a)},finish:function(a){if(!a[o.defaults.lang])if(l.log("Locales '"+o.defaults.lang+"' do not exist"),a[o.defaults.fallbackLang]&&o.defaults.fallbackLang!==o.defaults.lang)l.log("Falling back to '"+o.defaults.fallbackLang+"'"),l.setLang(o.defaults.fallbackLang);else if(Object.keys&&Object.keys(a).length){var c=Object.keys(a)[0];l.log("Falling back to '"+c+"'"),l.setLang(c)}else l.log("Invalid Locale File");l.updateLocales(a),o.defaults.autoTranslate&&l.client(function(){m.translate()}),k.initialized=!0,k.finish=(new Date).getTime(),l.client(function(){d(b).trigger("lingual:ready")}),"function"==typeof j&&j.call(o)}},o.locale=function(a){return"undefined"==typeof a?o.defaults.lang:("undefined"!=typeof k.localeStrings[a]&&(o.defaults.lang=a),o)},o.addLocales=function(a,b){l.loader.routine(a,function(){l.updateLocales(a),o.translate(),"function"==typeof b&&b()})},o.data=function(){return l.getLocales()},o.debug=function(){var a=e+"-debug";return k.debugging?(k.debugging=!1,d("#"+a).remove()):(k.debugging=!0,d("head").append('<style type="text/css" id="'+a+'">[data-'+o.defaults.selectorKey+"], ."+a+"{outline: 1px solid red;}</style>")),o},o.reset=function(){return k.reset=!0,l.setLang(l.detectLang()),o.translate(),o},o.translate=function(a){return l.client(function(){m.translate(a)}),o},o.gettext=function(a,b){var c=l.translate.fetch(a);return k.initialized?l.translate.inject(c,b):void 0},k.start=(new Date).getTime(),f?n.server(h,i):n.client(h,i);for(var p=0;p<o.plugins.length;p++)o.plugins[p].apply(o)};g.globals={},f?module.exports=g:(g.prototype.plugins=[],this[e]=g)}).apply(this,"undefined"!=typeof document?[window,document,navigator,jQuery]:[]);Lingual.version='1.9.0';